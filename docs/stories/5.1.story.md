# Story 5.1: Lampadaires (Obstacle Aérien)

## Status

Done

## Story

**As a** player,
**I want** to avoid streetlight tops while running,
**so that** the gameplay has more variety.

## Acceptance Criteria

1. **Lampadaire** composé de :
   - Poteau : élément décoratif (pas de collision), rectangle vertical fin
   - Partie haute : obstacle avec hitbox (rectangle + halo lumineux `#FFF3B0`)
2. Position de la partie haute : au-dessus de la hauteur du joueur au sol
3. Le joueur **au sol** passe en dessous sans collision
4. Le joueur **en saut** entre en collision avec la partie haute
5. Couleurs distinctes pour identifier rapidement le danger
6. Tests unitaires : collision détectée seulement quand joueur en l'air
7. `npm run lint` passe
8. `npm run test:run` passe
9. `npm run build` passe

## Tasks / Subtasks

- [x] **Task 1: Ajouter type streetlight** (AC: 1, 5)
  - [x] ObstacleType 'streetlight' dans types.ts
  - [x] ObstacleCategory 'ground' | 'aerial' dans types.ts
  - [x] Dimensions et couleurs dans constants.ts

- [x] **Task 2: Mettre à jour Obstacle.ts** (AC: 1, 2)
  - [x] Property category: 'ground' | 'aerial'
  - [x] Hitbox adaptée (partie haute seulement pour streetlight)
  - [x] Méthode getCategory()

- [x] **Task 3: Implémenter rendu lampadaire** (AC: 1, 5)
  - [x] renderStreetlight() - poteau + partie haute + halo
  - [x] Poteau : rectangle fin gris
  - [x] Partie haute : rectangle + halo semi-transparent

- [x] **Task 4: Mettre à jour collision** (AC: 3, 4)
  - [x] Collision aérienne : seulement si joueur jumping/falling
  - [x] Joueur au sol (idle/landing) : pas de collision avec aerial

- [x] **Task 5: Spawn aléatoire** (AC: 1)
  - [x] Ajouter streetlight au pool de spawn
  - [x] Pondération : 20% streetlight, 80% ground

- [x] **Task 6: Tests et Validation** (AC: 6, 7, 8, 9)
  - [x] Tests unitaires obstacle categories (6 tests)
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe (227 tests)
  - [x] `npm run build` passe

## Dev Notes

### Obstacle Category

```typescript
type ObstacleCategory = 'ground' | 'aerial';

// Streetlight config
streetlight: {
  width: 20,      // Poteau fin
  height: 120,    // Hauteur totale
  hitboxHeight: 30, // Partie haute seulement
  category: 'aerial',
  weight: 0.2,
}
```

### Collision Logic

```typescript
if (obstacle.getCategory() === 'aerial') {
  // Skip collision if player on ground
  if (player.getState() === 'idle' || player.getState() === 'landing') {
    continue;
  }
}
checkCollision(player, obstacle);
```

### Rendering

```
     [===] ← Halo + hitbox (partie haute)
       |
       |   ← Poteau (décoratif)
       |
    ───┴───  ← Sol
```

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | tests/unit/entities/Obstacle.test.ts |
| Unit | Vitest | tests/unit/core/Game.collision.test.ts |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-19 | 1.0 | Story créée | Dev Agent |
