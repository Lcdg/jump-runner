# Story 7.4: UI Tactile (Boutons & Skin Selector)

## Status

Ready for Review

## Story

**As a** mobile player,
**I want** touch-friendly buttons to access game features,
**so that** I can start the game and change skins without a keyboard.

## Acceptance Criteria

1. Bouton "Skins" (icÃ´ne ðŸŽ¨) visible en Attract Mode, zone tactile â‰¥ 44px
2. SÃ©lecteur de skin navigable par tap sur flÃ¨ches ou swipe gauche/droite
3. Zone de tap "Play" clairement indiquÃ©e en Attract Mode (gros bouton ou texte tapable)
4. Textes d'indication adaptÃ©s au contexte : "Tap to Start" sur mobile, "Press Space to Start" sur desktop
5. Le hint skins s'adapte : "Tap ðŸŽ¨ to change skin" sur mobile vs "Press S to change skin" sur desktop
6. Feedback visuel au tap sur les boutons (lÃ©gÃ¨re animation ou changement de couleur)
7. Tests unitaires pour le swipe et les zones tactiles
8. `npm run lint` passe
9. `npm run test:run` passe
10. `npm run build` passe

## Tasks / Subtasks

- [x] **Task 1: Ajouter le bouton Skins tactile** (AC: 1, 5)
  - [x] Dessiner un bouton ðŸŽ¨ en bas Ã  droite de l'Ã©cran en Attract Mode
  - [x] Zone tactile de 48x48px minimum
  - [x] Tap sur le bouton â†’ toggle skin selector
  - [x] Utiliser `isTouchDevice()` pour n'afficher le bouton que sur mobile
  - [x] Sur desktop, garder l'indication "Press S to change skin"

- [x] **Task 2: Adapter les textes selon la plateforme** (AC: 4, 5)
  - [x] Attract overlay : "Tap to Start" (mobile) vs "Press Space to Start" (desktop)
  - [x] Skin hint : bouton ðŸŽ¨ (mobile) vs "Press S to change skin" (desktop)
  - [x] Game Over : "Tap to Restart" (mobile) vs "Press Space to Restart" (desktop)
  - [x] Skin selector close : "Swipe or tap arrows - Tap ðŸŽ¨ to close" (mobile) vs "Press S or ESC to close" (desktop)

- [x] **Task 3: Ajouter le swipe dans le skin selector** (AC: 2)
  - [x] DÃ©tecter le swipe gauche/droite dans `SkinSelector` (touchstart â†’ touchend delta X)
  - [x] Seuil de swipe : 50px minimum pour Ã©viter les faux positifs
  - [x] Swipe gauche â†’ skin suivant, swipe droite â†’ skin prÃ©cÃ©dent

- [x] **Task 4: Ajouter le feedback visuel au tap** (AC: 6)
  - [x] LÃ©gÃ¨re rÃ©duction d'opacitÃ© (0.5) pendant le tap sur les boutons
  - [x] DurÃ©e de 100ms via timer
  - [x] Appliquer sur le bouton skins et les flÃ¨ches du sÃ©lecteur

- [x] **Task 5: Tests et Validation** (AC: 7, 8, 9, 10)
  - [x] Tests : swipe detection (delta X calcul)
  - [x] Tests : textes adaptÃ©s selon isTouchDevice
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe
  - [x] `npm run build` passe

## Dev Notes

### DÃ©pendances

- **Requiert Story 7.1** (platform.ts `isTouchDevice()`)
- **Requiert Story 7.2** (touch events de base fonctionnels)
- **Requiert Story 7.3** (layout adaptatif pour positionner les boutons)

### Code actuel

- `src/ui/SkinSelector.ts` : overlay avec flÃ¨ches â—„/â–º cliquables, `handleClick()` pour la souris
- `src/core/Game.ts` : `renderAttractOverlay()` affiche "Press Space to Start" et "Press S to change skin"
- `src/core/Game.ts` : `renderGameOverOverlay()` affiche "Press Space to Restart"

### Swipe detection

```typescript
// Sur touchstart : stocker la position X initiale
// Sur touchend : calculer deltaX = endX - startX
// Si |deltaX| > 50px â†’ swipe dÃ©tectÃ©
// deltaX > 0 â†’ swipe droite (skin suivant)
// deltaX < 0 â†’ swipe gauche (skin prÃ©cÃ©dent)
```

### Source tree impactÃ©

```
src/ui/SkinSelector.ts        # MODIFIÃ‰ (swipe, feedback)
src/core/Game.ts              # MODIFIÃ‰ (textes adaptatifs, bouton skins)
```

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | tests/unit/ui/SkinSelector.test.ts (update) |

### Standards de test
- Mocker `isTouchDevice()` pour tester les deux chemins (mobile/desktop)
- Simuler des touch events pour le swipe

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes
- Skins button (ðŸŽ¨) rendered in bottom-right corner on touch devices only (48x48px hit zone)
- Platform-adaptive texts: "Tap to Start" / "Tap to Restart" on mobile, keyboard instructions on desktop
- Swipe detection in SkinSelector: tracks touchstart X, calculates deltaX on touchend, 50px threshold
- Swipe left = next skin, swipe right = previous skin
- Visual feedback on tap: opacity drops to 0.5 for 100ms on skins button and selector arrows
- Close hint adapts: "Swipe or tap arrows - Tap ðŸŽ¨ to close" on mobile
- Game.ts registers touch events on canvas for swipe pass-through to SkinSelector
- 6 new tests: 4 swipe tests + 2 platform-adaptive close hint tests (353 total)

### File List
| File | Action |
|------|--------|
| src/core/Game.ts | Modified |
| src/ui/SkinSelector.ts | Modified |
| tests/unit/ui/SkinSelector.test.ts | Modified |

### Debug Log References
None

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-01 | 1.0 | Story crÃ©Ã©e | PO Agent (Sarah) |
| 2026-02-02 | 1.1 | ImplÃ©mentation complÃ¨te - bouton skins, textes adaptatifs, swipe, feedback visuel | Dev Agent (James) |
