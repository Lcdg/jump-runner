# Story 7.1: Viewport & Meta Tags Mobile

## Status

Ready for Review

## Story

**As a** mobile player,
**I want** the game to display correctly on my phone,
**so that** there is no unwanted zoom, scroll, or browser UI interfering with gameplay.

## Acceptance Criteria

1. Meta viewport configuré pour empêcher le zoom utilisateur et le double-tap zoom
2. Pas de pull-to-refresh, bounce scroll, ou text selection sur le canvas
3. Canvas fullscreen sans barre d'adresse visible (PWA standalone display mode via manifest)
4. Détection fiable tactile vs desktop (`isTouchDevice`) accessible globalement
5. `npm run lint` passe
6. `npm run test:run` passe
7. `npm run build` passe

## Tasks / Subtasks

- [x] **Task 1: Configurer les meta tags viewport** (AC: 1)
  - [x] Modifier `index.html` : ajouter `maximum-scale=1`, `user-scalable=no`, `viewport-fit=cover`
  - [x] Ajouter meta `apple-mobile-web-app-capable` pour iOS
  - [x] Ajouter meta `mobile-web-app-capable` pour Android

- [x] **Task 2: Empêcher les comportements par défaut mobile** (AC: 2)
  - [x] CSS : `touch-action: none` sur le canvas
  - [x] CSS : `-webkit-user-select: none; user-select: none` sur body
  - [x] CSS : `overscroll-behavior: none` sur html/body pour bloquer pull-to-refresh
  - [x] JS : `event.preventDefault()` sur `touchstart`/`touchmove` du canvas

- [x] **Task 3: Ajouter un manifest PWA minimal** (AC: 3)
  - [x] Créer `public/manifest.json` avec `display: standalone`, nom, couleurs thème
  - [x] Référencer le manifest dans `index.html`
  - [x] Ajouter meta `theme-color` (#0D1B2A pour le thème nuit)

- [x] **Task 4: Créer un utilitaire de détection mobile** (AC: 4)
  - [x] Créer `src/utils/platform.ts`
  - [x] Fonction `isTouchDevice(): boolean` basée sur `'ontouchstart' in window` + `navigator.maxTouchPoints`
  - [x] Exporter pour usage dans InputManager et UI

- [x] **Task 5: Tests et Validation** (AC: 5, 6, 7)
  - [x] Tests unitaires pour `isTouchDevice` (mock window/navigator)
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe
  - [x] `npm run build` passe

## Dev Notes

### Dépendances

- Aucune dépendance interne (première story de l'Epic 7)

### Fichiers actuels

- `index.html` : viewport basique déjà en place (`width=device-width, initial-scale=1.0`), CSS fullscreen existant (`100vw/100vh`, `overflow: hidden`)
- Le canvas utilise déjà `display: block; width: 100vw; height: 100vh`

### Points d'attention

- Ne PAS casser le comportement desktop (les meta tags mobile n'affectent pas le desktop)
- Le `touch-action: none` est essentiel pour que les touch events fonctionnent correctement dans la Story 7.2
- Le manifest PWA permet l'installation sur l'écran d'accueil et masque la barre d'adresse

### Source tree impacté

```
index.html                    # MODIFIÉ (meta tags, manifest link)
public/manifest.json          # NOUVEAU (PWA manifest)
src/utils/platform.ts         # NOUVEAU (détection mobile)
```

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | tests/unit/utils/platform.test.ts |

### Standards de test
- Mocker `window` et `navigator` pour tester `isTouchDevice`
- Tester les deux cas : touch disponible et non disponible

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### Completion Notes
- All 5 tasks implemented and validated
- 337 tests pass (3 new platform.test.ts tests)
- Lint clean, build successful

### File List
| File | Action |
|------|--------|
| index.html | MODIFIED (meta tags, CSS, manifest link) |
| public/manifest.json | CREATED (PWA manifest) |
| src/utils/platform.ts | CREATED (isTouchDevice utility) |
| src/rendering/Renderer.ts | MODIFIED (touch preventDefault) |
| eslint.config.js | MODIFIED (navigator global) |
| tests/unit/utils/platform.test.ts | CREATED (3 tests) |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-01 | 1.0 | Story créée | PO Agent (Sarah) |
| 2026-02-01 | 1.1 | Implementation complete | Dev Agent (James) |
