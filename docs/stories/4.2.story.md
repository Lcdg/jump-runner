# Story 4.2: Décor - Immeubles Arrière-Plan

## Status

Done

## Story

**As a** player,
**I want** to see building silhouettes with lit windows in the background,
**so that** the night city atmosphere is established.

## Acceptance Criteria

1. Silhouettes d'immeubles rectangulaires en arrière-plan (`#1B263B`)
2. Fenêtres éclairées (petits carrés jaunes `#FFD60A`) placées aléatoirement
3. Parallaxe : immeubles défilent à 30-50% de la vitesse du sol
4. Maximum 5-6 immeubles visibles simultanément (performance)
5. Immeubles générés procéduralement (hauteurs et largeurs variées)
6. Tests : vérifier le défilement parallaxe

## Tasks / Subtasks

- [x] **Task 1: Créer type Building** (AC: 5)
  - [x] Interface Building avec x, width, height, windows[]
  - [x] Interface Window avec x, y (relatives à l'immeuble)

- [x] **Task 2: Implémenter génération d'immeubles** (AC: 4, 5)
  - [x] Générer immeubles avec dimensions aléatoires
  - [x] Limiter à 5-6 immeubles visibles
  - [x] Placer fenêtres aléatoirement sur chaque immeuble

- [x] **Task 3: Implémenter rendu immeubles** (AC: 1, 2)
  - [x] renderBuildings() dans Game.ts
  - [x] Dessiner silhouettes (#1B263B)
  - [x] Dessiner fenêtres éclairées (#FFD60A)

- [x] **Task 4: Implémenter parallaxe** (AC: 3)
  - [x] Ajouter constante PARALLAX_SPEED (0.4 = 40%)
  - [x] Mettre à jour position immeubles avec vitesse réduite
  - [x] Recycler immeubles sortis à gauche

- [x] **Task 5: Validation** (AC: 6)
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe (207 tests)
  - [x] `npm run build` passe
  - [x] Test manuel: vérifier effet parallaxe

## Dev Notes

### Architecture

```typescript
interface Window {
  x: number; // Position relative à l'immeuble
  y: number;
}

interface Building {
  x: number;
  width: number;
  height: number;
  windows: Window[];
}
```

### Constantes à ajouter

```typescript
export const BUILDINGS = {
  COUNT: 6,
  MIN_WIDTH: 80,
  MAX_WIDTH: 150,
  MIN_HEIGHT: 150,
  MAX_HEIGHT: 350,
  GAP: 30, // Espace entre immeubles
  PARALLAX_SPEED: 0.4, // 40% de la vitesse du sol
  WINDOW_SIZE: 8,
  WINDOW_GAP: 20,
  WINDOW_MARGIN: 15,
} as const;
```

### Rendering Order (Z-index)

1. Ciel (COLORS.SKY) - déjà fait
2. **Immeubles (nouveau)** ← à implémenter
3. Sol + decorations
4. Obstacles
5. Personnage
6. UI

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | N/A (changement visuel) |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-18 | 1.0 | Story créée | Dev Agent (James) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes List
- Interfaces Building et BuildingWindow ajoutées dans types.ts
- Constantes BUILDINGS ajoutées dans constants.ts
- Système de génération procédurale des immeubles avec fenêtres aléatoires
- Parallaxe à 40% de la vitesse du sol (BUILDINGS.PARALLAX_SPEED = 0.4)
- Immeubles chargent hors écran à droite (pas visibles au démarrage)
- Espaces aléatoires entre immeubles (20% de chance d'un gap 2-4x plus grand)
- Recyclage des immeubles quand ils sortent à gauche

### File List
**Modified:**
- `src/core/types.ts` - Ajout interfaces Building, BuildingWindow
- `src/config/constants.ts` - Ajout BUILDINGS constants
- `src/core/Game.ts` - Ajout système immeubles (init, generate, update, render)
