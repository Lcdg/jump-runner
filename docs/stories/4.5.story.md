# Story 4.5: Personnage - Jambes + Animation Course

## Status

Done

## Story

**As a** player,
**I want** to see the character with animated legs,
**so that** I feel like I'm running through the city.

## Acceptance Criteria

1. **Jambes** : 2 rectangles (6x20px) sous le corps, couleur `#FF6B35`
2. **Animation course** : Alternance des jambes en loop 200ms (état `idle`)
3. **Saut** : Jambes groupées pendant la montée et descente
4. **Atterrissage** : Reprend l'animation de course
5. Tests unitaires pour l'animation timer
6. `npm run lint` passe
7. `npm run test:run` passe
8. `npm run build` passe

## Tasks / Subtasks

- [x] **Task 1: Ajouter constantes jambes** (AC: 1)
  - [x] PLAYER.LEG_WIDTH, LEG_HEIGHT, LEG_GAP dans constants.ts
  - [x] PLAYER.RUN_CYCLE_DURATION (200ms)

- [x] **Task 2: Ajouter animation timer au Player** (AC: 2, 3, 4)
  - [x] Property runAnimationTimer: number
  - [x] Update timer dans update() quand idle
  - [x] Reset timer quand jump/land
  - [x] Méthode getRunAnimationPhase(): number (0-1)

- [x] **Task 3: Modifier renderPlayer()** (AC: 1, 2, 3)
  - [x] Dessiner 2 jambes sous le corps
  - [x] Animer position X des jambes selon phase
  - [x] Jambes groupées si jumping/falling

- [x] **Task 4: Tests et Validation** (AC: 5, 6, 7, 8)
  - [x] Tests unitaires animation timer (6 tests)
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe (215 tests)
  - [x] `npm run build` passe

## Dev Notes

### Animation Logic

```typescript
// Phase: 0 → 0.5 → 1 → 0.5 → 0 (cycle)
// Leg offset = sin(phase * 2π) * amplitude
const phase = (runAnimationTimer % RUN_CYCLE_DURATION) / RUN_CYCLE_DURATION;
const legOffset = Math.sin(phase * Math.PI * 2) * LEG_AMPLITUDE;

// Left leg: +offset, Right leg: -offset
```

### Leg Positions

```
    [HEAD]
    [BODY]
   /      \
[LEG1]  [LEG2]
```

- Legs attached at bottom of body
- Gap between legs: ~8px
- Amplitude of movement: ~6px forward/backward

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | tests/unit/entities/Player.test.ts |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-19 | 1.0 | Story créée | Dev Agent |
