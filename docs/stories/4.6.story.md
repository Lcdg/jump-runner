# Story 4.6: Personnage - Animation Saut

## Status

Done

## Story

**As a** player,
**I want** to see a squash effect when landing,
**so that** the jump feels more dynamic and satisfying.

## Acceptance Criteria

1. **Squash à l'atterrissage** : compression verticale du personnage (50ms)
2. **Facteur de compression** : ~80% hauteur, ~120% largeur
3. **Transition fluide** : retour progressif à la forme normale
4. **Jambes groupées** : pendant le saut (déjà implémenté en 4.5)
5. Tests unitaires pour l'état landing
6. `npm run lint` passe
7. `npm run test:run` passe
8. `npm run build` passe

## Tasks / Subtasks

- [x] **Task 1: Ajouter constantes squash** (AC: 1, 2)
  - [x] PLAYER.SQUASH_DURATION (0.05s)
  - [x] PLAYER.SQUASH_SCALE_Y (0.8)
  - [x] PLAYER.SQUASH_SCALE_X (1.2)

- [x] **Task 2: Ajouter état landing au Player** (AC: 1, 3)
  - [x] Nouvel état 'landing' dans PlayerState
  - [x] Property squashTimer: number
  - [x] Transition falling → landing → idle
  - [x] Méthode getSquashFactor(): { scaleX, scaleY }

- [x] **Task 3: Modifier renderPlayer()** (AC: 1, 2)
  - [x] Appliquer scale Y/X selon squash factor
  - [x] Garder les pieds au sol pendant le squash

- [x] **Task 4: Tests et Validation** (AC: 5, 6, 7, 8)
  - [x] Tests unitaires état landing (6 tests)
  - [x] `npm run lint` passe
  - [x] `npm run test:run` passe (221 tests)
  - [x] `npm run build` passe

## Dev Notes

### Squash Animation

```typescript
// Squash factor: 1.0 = normal, 0.8 = compressed
// Timer goes from SQUASH_DURATION to 0
const progress = 1 - (squashTimer / SQUASH_DURATION);
const squashFactor = SQUASH_SCALE_Y + (1 - SQUASH_SCALE_Y) * progress;
```

### State Transitions

```
idle → jumping → falling → landing → idle
                              ↓
                         (50ms squash)
```

## Testing

| Type | Framework | Location |
|------|-----------|----------|
| Unit | Vitest | tests/unit/entities/Player.test.ts |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-19 | 1.0 | Story créée | Dev Agent |
